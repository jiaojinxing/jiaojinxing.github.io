
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Hercules TMS570LC43x LaunchPad SylixOS移植记录 | JinXing’s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="jiaojinxing">
    

    
    <meta name="description" content="Hercules TMS570LC43x LaunchPad是TI官方出的TMS570LC43x芯片DEMO板：http://www.ti.com/tool/launchxl2-570lc43
TMS570LC43x使用ARM Cortex-R5核心，主频300MHz，有MPU、CACHE、FPU，没有MMU，Flash有4MB，RAM只有512KB，近日成功跑起SylixOS，记录一下移植过程以">
<meta property="og:type" content="article">
<meta property="og:title" content="Hercules TMS570LC43x LaunchPad SylixOS移植记录">
<meta property="og:url" content="jiaojinxing.github.io/2017/01/12/Hercules-TMS570LC43x-LaunchPad-SylixOS移植记录/index.html">
<meta property="og:site_name" content="JinXing’s blog">
<meta property="og:description" content="Hercules TMS570LC43x LaunchPad是TI官方出的TMS570LC43x芯片DEMO板：http://www.ti.com/tool/launchxl2-570lc43
TMS570LC43x使用ARM Cortex-R5核心，主频300MHz，有MPU、CACHE、FPU，没有MMU，Flash有4MB，RAM只有512KB，近日成功跑起SylixOS，记录一下移植过程以">
<meta property="og:image" content="jiaojinxing.github.io/img/Hercules-TMS570LC43x-LaunchPad/Image 22.png">
<meta property="og:image" content="jiaojinxing.github.io/img/Hercules-TMS570LC43x-LaunchPad/Image 3.png">
<meta property="og:image" content="jiaojinxing.github.io/img/Hercules-TMS570LC43x-LaunchPad/Image 4.png">
<meta property="og:image" content="jiaojinxing.github.io/img/Hercules-TMS570LC43x-LaunchPad/Image 5.png">
<meta property="og:image" content="jiaojinxing.github.io/img/Hercules-TMS570LC43x-LaunchPad/Image 6.png">
<meta property="og:image" content="jiaojinxing.github.io/img/Hercules-TMS570LC43x-LaunchPad/Image 7.png">
<meta property="og:image" content="jiaojinxing.github.io/img/Hercules-TMS570LC43x-LaunchPad/Image 8.png">
<meta property="og:image" content="jiaojinxing.github.io/img/Hercules-TMS570LC43x-LaunchPad/Image 9.png">
<meta property="og:image" content="jiaojinxing.github.io/img/Hercules-TMS570LC43x-LaunchPad/Image 10.png">
<meta property="og:image" content="jiaojinxing.github.io/img/Hercules-TMS570LC43x-LaunchPad/Image 11.png">
<meta property="og:image" content="jiaojinxing.github.io/img/Hercules-TMS570LC43x-LaunchPad/Image 12.png">
<meta property="og:image" content="jiaojinxing.github.io/img/Hercules-TMS570LC43x-LaunchPad/Image 13.png">
<meta property="og:image" content="jiaojinxing.github.io/img/Hercules-TMS570LC43x-LaunchPad/Image 14.png">
<meta property="og:image" content="jiaojinxing.github.io/img/Hercules-TMS570LC43x-LaunchPad/Image 16.png">
<meta property="og:image" content="jiaojinxing.github.io/img/Hercules-TMS570LC43x-LaunchPad/Image 17.png">
<meta property="og:image" content="jiaojinxing.github.io/img/Hercules-TMS570LC43x-LaunchPad/Image 19.png">
<meta property="og:image" content="jiaojinxing.github.io/img/Hercules-TMS570LC43x-LaunchPad/Image 20.png">
<meta property="og:updated_time" content="2017-01-12T06:53:04.455Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hercules TMS570LC43x LaunchPad SylixOS移植记录">
<meta name="twitter:description" content="Hercules TMS570LC43x LaunchPad是TI官方出的TMS570LC43x芯片DEMO板：http://www.ti.com/tool/launchxl2-570lc43
TMS570LC43x使用ARM Cortex-R5核心，主频300MHz，有MPU、CACHE、FPU，没有MMU，Flash有4MB，RAM只有512KB，近日成功跑起SylixOS，记录一下移植过程以">

    
    <link rel="alternative" href="/atom.xml" title="JinXing’s blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="JinXing’s blog" title="JinXing’s blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="JinXing’s blog">JinXing’s blog</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
						<form class="search">
							<label>Search</label>
						<input type="text" id="ts-search-input" name="q" size="30" placeholder="搜索"><br>
						</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/01/12/Hercules-TMS570LC43x-LaunchPad-SylixOS移植记录/" title="Hercules TMS570LC43x LaunchPad SylixOS移植记录" itemprop="url">Hercules TMS570LC43x LaunchPad SylixOS移植记录</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="jiaojinxing" target="_blank" itemprop="author">jiaojinxing</a>
		
  <p class="article-time">
    <time datetime="2017-01-12T01:53:20.000Z" itemprop="datePublished"> 发表于 2017-01-12</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#硬件连接"><span class="toc-number">1.</span> <span class="toc-text">硬件连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sylixos-base裁减"><span class="toc-number">2.</span> <span class="toc-text">sylixos-base裁减</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#libsylixos裁减"><span class="toc-number">3.</span> <span class="toc-text">libsylixos裁减</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#libsylixos配置"><span class="toc-number">4.</span> <span class="toc-text">libsylixos配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HALCoGen使用"><span class="toc-number">5.</span> <span class="toc-text">HALCoGen使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BSP编写"><span class="toc-number">6.</span> <span class="toc-text">BSP编写</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#链接脚本_SylixOSBSP-ld"><span class="toc-number">6.1.</span> <span class="toc-text">链接脚本 SylixOSBSP.ld</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#config-h"><span class="toc-number">6.2.</span> <span class="toc-text">config.h</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bsparmr5-mk"><span class="toc-number">6.3.</span> <span class="toc-text">bsparmr5.mk</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bspInit-c关键内容"><span class="toc-number">6.4.</span> <span class="toc-text">bspInit.c关键内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bspLib-c_关键内容"><span class="toc-number">6.5.</span> <span class="toc-text">bspLib.c 关键内容</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CCS调试"><span class="toc-number">7.</span> <span class="toc-text">CCS调试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#晒图"><span class="toc-number">8.</span> <span class="toc-text">晒图</span></a></li></ol>
		
		</div>
		
		<p>Hercules TMS570LC43x LaunchPad是TI官方出的TMS570LC43x芯片DEMO板：<br><a href="http://www.ti.com/tool/launchxl2-570lc43" target="_blank" rel="external">http://www.ti.com/tool/launchxl2-570lc43</a></p>
<p>TMS570LC43x使用ARM Cortex-R5核心，主频300MHz，<br>有MPU、CACHE、FPU，没有MMU，Flash有4MB，RAM只有512KB，近日成功跑起SylixOS，记录一下移植过程以备忘。</p>
<h2 id="硬件连接">硬件连接</h2><p>使用一USB转TTL模块连接LaunchPad有SCI3，如下图：<br><img src="/img/Hercules-TMS570LC43x-LaunchPad/Image 22.png" alt="Image 22.png"></p>
<h2 id="sylixos-base裁减">sylixos-base裁减</h2><p>目前只编译libsylixos，sylixos-base的makefile如下：<br><figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="constant">COMPONENTS </span>= \</span><br><span class="line">libsylixos \</span><br><span class="line"></span><br><span class="line"><span class="symbol">all:</span> <span class="variable">$(</span><span class="constant">COMPONENTS)</span></span><br><span class="line">	<span class="variable">@for</span> target <span class="keyword">in</span> <span class="variable">$(</span><span class="constant">COMPONENTS)</span>; <span class="keyword">do</span> make -<span class="constant">C </span><span class="variable">$$</span>target all -j <span class="number">16</span>; done</span><br><span class="line"></span><br><span class="line"><span class="symbol">clean:</span> <span class="variable">$(</span><span class="constant">COMPONENTS)</span></span><br><span class="line">	<span class="variable">@for</span> target <span class="keyword">in</span> <span class="variable">$(</span><span class="constant">COMPONENTS)</span>; <span class="keyword">do</span> make -<span class="constant">C </span><span class="variable">$$</span>target clean; done</span><br></pre></td></tr></table></figure></p>
<h2 id="libsylixos裁减">libsylixos裁减</h2><p>libsylixos也需要裁减，libsylixos的makefile，修改BUILD_LITE_TARGET变量值为1，即编译lite版本：<br><figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line"><span class="keyword">BUILD_LITE_TARGET </span>= <span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p>libsylixos下的libsylixos.mk，去掉：<br><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">SylixOS/fs/mtd/mtdcore<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/mtd/linux/bch<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/mtd/linux/strim<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/mtd/nand/nand_base<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/mtd/nand/nand_bbt<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/mtd/nand/nand_bch<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/mtd/nand/nand_ecc<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/mtd/nand/nand_ids<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/mtd/onenand/onenand_base<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/mtd/onenand/onenand_bbt<span class="class">.c</span> \</span><br></pre></td></tr></table></figure></p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">SylixOS/fs/yaffs2/yaffs_allocator<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/yaffs2/yaffs_attribs<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/yaffs2/yaffs_bitmap<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/yaffs2/yaffs_checkptrw<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/yaffs2/yaffs_ecc<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/yaffs2/yaffs_guts<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/yaffs2/yaffs_mtdif_multi<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/yaffs2/yaffs_nameval<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/yaffs2/yaffs_nand<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/yaffs2/yaffs_nor<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/yaffs2/yaffs_packedtags1<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/yaffs2/yaffs_packedtags2<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/yaffs2/yaffs_summary<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/yaffs2/yaffs_sylixos<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/yaffs2/yaffs_sylixosproc<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/yaffs2/yaffs_tagscompat<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/yaffs2/yaffs_tagsmarshall<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/yaffs2/yaffs_verify<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/yaffs2/yaffs_yaffs1<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/yaffs2/yaffs_yaffs2<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/yaffs2/direct/yaffscfg<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/yaffs2/direct/yaffsfs<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/yaffs2/direct/yaffs_hweight<span class="class">.c</span> \</span><br><span class="line">SylixOS/fs/yaffs2/direct/yaffs_qsort.c</span><br></pre></td></tr></table></figure>
<p>同时将：<br><figure class="highlight fix"><table><tr><td class="code"><pre><span class="line"><span class="attribute">NET_SRCS </span>=<span class="string"> \</span></span><br></pre></td></tr></table></figure></p>
<p>修改为：<br><figure class="highlight fix"><table><tr><td class="code"><pre><span class="line"><span class="attribute">NO_NET_SRCS </span>=<span class="string"> \</span></span><br></pre></td></tr></table></figure></p>
<p>即不编译mtd、yaffs2、net。</p>
<h2 id="libsylixos配置">libsylixos配置</h2><p>修改的配置项目比较多，这里只罗列重要的几个，如下：</p>
<p>SylixOS\config\cpu\cpu_cfg_arm.h：<br><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="hexcolor">#def</span>ine LW_CFG_ARM_PL330                <span class="number">0</span>                               <span class="comment">/*  是否允许 PL330 DMA 驱动     */</span></span><br><span class="line"><span class="hexcolor">#def</span>ine LW_CFG_ARM_CACHE_L2             <span class="number">0</span>                               <span class="comment">/*  是否允许管理 ARM 二级 CACHE */</span></span><br><span class="line"><span class="hexcolor">#def</span>ine LW_CFG_ARM_CACHE_L2_ECC         <span class="number">0</span>                               <span class="comment">/*  是否打开 ARM 二级 CACHE ECC */</span></span><br></pre></td></tr></table></figure></p>
<p>SylixOS\config\kernel\vmm_cfg.h：<br><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="hexcolor">#def</span>ine LW_CFG_VMM_EN                         <span class="number">0</span>                         <span class="comment">/*  是否需要对虚拟内存的支持    */</span></span><br></pre></td></tr></table></figure></p>
<p>SylixOS\config\mp\mp_cfg.h：<br><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="hexcolor">#def</span>ine LW_CFG_SMP_EN                   <span class="number">0</span>               <span class="comment">/*  是否需要系统对多处理器支持                  */</span></span><br></pre></td></tr></table></figure></p>
<h2 id="HALCoGen使用">HALCoGen使用</h2><p>使用HALCoGen新建一个工程：</p>
<p>CPU按图选择，TOOLS 使用 GCC：<br><img src="/img/Hercules-TMS570LC43x-LaunchPad/Image 3.png" alt="Image 3.png"></p>
<p>使能 GIO、SCI3、RTI驱动：<br><img src="/img/Hercules-TMS570LC43x-LaunchPad/Image 4.png" alt="Image 4.png"></p>
<p>配置SCI3的管脚复用：<br><img src="/img/Hercules-TMS570LC43x-LaunchPad/Image 5.png" alt="Image 5.png"></p>
<p>配置SCI3的波特率为115200：<br><img src="/img/Hercules-TMS570LC43x-LaunchPad/Image 6.png" alt="Image 6.png"></p>
<p>配置SCI3的PORT：<br><img src="/img/Hercules-TMS570LC43x-LaunchPad/Image 7.png" alt="Image 7.png"></p>
<p>配置异常向量表：<br><img src="/img/Hercules-TMS570LC43x-LaunchPad/Image 8.png" alt="Image 8.png"></p>
<p>配置各处理器模式的堆栈空间大小：<br><img src="/img/Hercules-TMS570LC43x-LaunchPad/Image 9.png" alt="Image 9.png"></p>
<p>配置GIO PORTB BIT6为输出：<br><img src="/img/Hercules-TMS570LC43x-LaunchPad/Image 10.png" alt="Image 10.png"></p>
<h2 id="BSP编写">BSP编写</h2><p>创建 bsp，模板使用arm-none，名字为bsparmr5。</p>
<p>将 HALCoGen 生成的代码放到 SylixOS/driver/HCG 目录。</p>
<p>将 config.ld 的内容清空，因为链接脚本不需要配置了。</p>
<p>将 SylixOS/bsp/symbol.c 排除到工程外。</p>
<p>将 SylixOS/bsp/bspMap.h 删除，同时 bspInit.c 不再 include 该头文件。</p>
<p>修改 SylixOS/driver/HCG/source/HL_sys_startup.c：<br><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* USER CODE BEGIN (26) */</span></span><br><span class="line">    <span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">bspInit</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line">    bspInit();</span><br><span class="line"><span class="comment">/* USER CODE END */</span></span><br></pre></td></tr></table></figure></p>
<p>修改 SylixOS/driver/HCG/source/HL<em>sys_core.s文件的_coreInitStackPointer</em>函数，返回前通过cps #19进入SVC模式：<br><figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line"><span class="label">_coreInitStackPointer_</span>:</span><br><span class="line">        <span class="keyword">cps </span>  <span class="number">#17</span></span><br><span class="line">        <span class="keyword">ldr </span>  <span class="literal">sp</span>,       fiqSp</span><br><span class="line">        <span class="keyword">cps </span>  <span class="number">#18</span></span><br><span class="line">        <span class="keyword">ldr </span>  <span class="literal">sp</span>,       irqSp</span><br><span class="line">        <span class="keyword">cps </span>  <span class="number">#19</span></span><br><span class="line">        <span class="keyword">ldr </span>  <span class="literal">sp</span>,       <span class="keyword">svcSp</span><br><span class="line"></span>        <span class="keyword">cps </span>  <span class="number">#23</span></span><br><span class="line">        <span class="keyword">ldr </span>  <span class="literal">sp</span>,       abortSp</span><br><span class="line">        <span class="keyword">cps </span>  <span class="number">#27</span></span><br><span class="line">        <span class="keyword">ldr </span>  <span class="literal">sp</span>,       undefSp</span><br><span class="line">        <span class="keyword">cps </span>  <span class="number">#31</span></span><br><span class="line">        <span class="keyword">ldr </span>  <span class="literal">sp</span>,       userSp</span><br><span class="line">        <span class="keyword">cps </span>  <span class="number">#19</span> </span><br><span class="line">        <span class="keyword">bx </span>   <span class="literal">lr</span></span><br></pre></td></tr></table></figure></p>
<h3 id="链接脚本_SylixOSBSP-ld">链接脚本 SylixOSBSP.ld</h3><p>使用 SylixOS/driver/HCG/source/HL_sys_link.ld 的内容，加入:</p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">  PROVIDE ( end = _ebss );</span><br><span class="line">  PROVIDE ( _end = _ebss );</span><br><span class="line">  </span><br><span class="line">/<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">    内核堆段</span><br><span class="line"><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>/</span><br><span class="line"></span><br><span class="line">    .heap (NOLOAD) : &#123;</span><br><span class="line">        . = ALIGN(8);</span><br><span class="line">        PROVIDE (__heap_start = .);</span><br><span class="line">        </span><br><span class="line">        __heap_end = ORIGIN(RAM) + LENGTH(RAM) - 128;</span><br><span class="line">        PROVIDE (__heap_end = .);</span><br><span class="line">    &#125; &gt; RAM</span><br></pre></td></tr></table></figure>
<h3 id="config-h">config.h</h3><p>内容如下，需要根据芯片的 Flash 和 RAM 的地址、容量来修改：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">define</span> BSP_CFG_ROM_BASE (0x00000000)</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> BSP_CFG_ROM_SIZE (4 * 1024 * 1024)</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> BSP_CFG_RAM_BASE (0x08000000)</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> BSP_CFG_RAM_SIZE (512 * 1024)</span></span><br></pre></td></tr></table></figure>
<h3 id="bsparmr5-mk">bsparmr5.mk</h3><p>关键变量如下：</p>
<figure class="highlight haml"><table><tr><td class="code"><pre><span class="line">LOCAL_INC_PATH :=  \</span><br><span class="line">-<span class="ruby"><span class="constant">I</span><span class="string">"./SylixOS"</span> \</span><br><span class="line"></span>-<span class="ruby"><span class="constant">I</span><span class="string">"./SylixOS/bsp"</span> \</span><br><span class="line"></span>-<span class="ruby"><span class="constant">I</span><span class="string">"$(WORKSPACE_bsparmr5)/SylixOS\driver\HCG\include"</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight haml"><table><tr><td class="code"><pre><span class="line">LOCAL_DSYMBOL :=  \</span><br><span class="line">-<span class="ruby"><span class="constant">D__BOOT_INROM</span>=<span class="number">1</span> \</span><br><span class="line"></span>-<span class="ruby"><span class="constant">D__SYLIXOS_LITE</span>=<span class="number">1</span></span></span><br></pre></td></tr></table></figure>
<p>加入SylixOS/driver/HCG/source/HL_sys_core.s的编译，它需要使用浮点才能编译通过：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ARM_FPU_ASFLAGS = -mfloat-abi=softfp -mfpu=vfpv3</span><br><span class="line"></span><br><span class="line">$(OBJPATH)/$(LOCAL_TARGET_NAME)/SylixOS/driver/HCG/<span class="built_in">source</span>/HL_sys_core.o: ./SylixOS/driver/HCG/<span class="built_in">source</span>/HL_sys_core.s</span><br><span class="line">		@<span class="keyword">if</span> [ ! <span class="operator">-d</span> <span class="string">"<span class="variable">$(dir $@)</span>"</span> ]; <span class="keyword">then</span> \</span><br><span class="line">			mkdir -p <span class="string">"<span class="variable">$(dir $@)</span>"</span>; <span class="keyword">fi</span></span><br><span class="line">		@<span class="keyword">if</span> [ ! <span class="operator">-d</span> <span class="string">"<span class="variable">$(dir $(__DEP)</span>)"</span> ]; <span class="keyword">then</span> \</span><br><span class="line">			mkdir -p <span class="string">"<span class="variable">$(dir $(__DEP)</span>)"</span>; <span class="keyword">fi</span></span><br><span class="line">		$(AS) $(ARM_FPU_ASFLAGS) $($(__TARGET)_ASFLAGS_WITHOUT_FPUFLAGS) -MMD -MP -MF $(__DEP) -c $&lt; -o <span class="variable">$@</span></span><br></pre></td></tr></table></figure>
<h3 id="bspInit-c关键内容">bspInit.c关键内容</h3><p>cortex-r5 同样支持 WFI 指令：<br><figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">VOID</span>  halIdleInit (<span class="keyword">VOID</span>)</span><br><span class="line">&#123;</span><br><span class="line">    API_SystemHookAdd(armWaitForInterrupt,</span><br><span class="line">                      LW_OPTION_THREAD_IDLE_HOOK);                      <span class="comment">/*  空闲时暂停 CPU              */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>CACHE 初始化：<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> VOID  halCacheInit (VOID)</span><br><span class="line">&#123;</span><br><span class="line">    API_CacheLibInit(<span class="built_in">CACHE_COPYBACK</span>, <span class="built_in">CACHE_COPYBACK</span>, ARM_MACHINE_R5);   <span class="comment">/*  初始化 CACHE 系统           */</span></span><br><span class="line">    API_CacheEnable(I<span class="built_in">NSTRUCTION_CACHE</span>);</span><br><span class="line">    API_CacheEnable(DATA_<span class="built_in">CACHE</span>);                                        <span class="comment">/*  使能 CACHE                  */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>FPU 初始化（使用 VFPv3-d16）：<br><figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">VOID</span>  halFpuInit (<span class="keyword">VOID</span>)</span><br><span class="line">&#123;</span><br><span class="line">    API_KernelFpuInit(ARM_MACHINE_R5, ARM_FPU_VFPv3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>没有硬盘，使用 ramfs：<br><figure class="highlight openscad"><table><tr><td class="code"><pre><span class="line">static VOID  halStdDirInit <span class="params">(VOID)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/*</span><br><span class="line">     * 没有硬盘，使用 ramfs，并链接到根文件系统的目录</span><br><span class="line">     */</span></span><br><span class="line">    system<span class="params">(<span class="string">"mount -t ramfs 0 /ram"</span>)</span>;</span><br><span class="line">    mkdir<span class="params">(<span class="string">"/ram/boot"</span>, DEFAULT_DIR_PERM)</span>;</span><br><span class="line">    mkdir<span class="params">(<span class="string">"/ram/etc"</span>, DEFAULT_DIR_PERM)</span>;</span><br><span class="line">    mkdir<span class="params">(<span class="string">"/ram/ftk"</span>, DEFAULT_DIR_PERM)</span>;</span><br><span class="line">    mkdir<span class="params">(<span class="string">"/ram/qt"</span>, DEFAULT_DIR_PERM)</span>;</span><br><span class="line">    mkdir<span class="params">(<span class="string">"/ram/lib"</span>, DEFAULT_DIR_PERM)</span>;</span><br><span class="line">    mkdir<span class="params">(<span class="string">"/ram/lib/modules"</span>, DEFAULT_DIR_PERM)</span>;</span><br><span class="line">    mkdir<span class="params">(<span class="string">"/ram/usr"</span>, DEFAULT_DIR_PERM)</span>;</span><br><span class="line">    mkdir<span class="params">(<span class="string">"/ram/usr/lib"</span>, DEFAULT_DIR_PERM)</span>;</span><br><span class="line">    mkdir<span class="params">(<span class="string">"/ram/bin"</span>, DEFAULT_DIR_PERM)</span>;</span><br><span class="line">    mkdir<span class="params">(<span class="string">"/ram/sbin"</span>, DEFAULT_DIR_PERM)</span>;</span><br><span class="line">    mkdir<span class="params">(<span class="string">"/ram/apps"</span>, DEFAULT_DIR_PERM)</span>;</span><br><span class="line">    mkdir<span class="params">(<span class="string">"/ram/home"</span>, DEFAULT_DIR_PERM)</span>;</span><br><span class="line">    mkdir<span class="params">(<span class="string">"/ram/root"</span>, DEFAULT_DIR_PERM)</span>;</span><br><span class="line">    mkdir<span class="params">(<span class="string">"/ram/var"</span>, DEFAULT_DIR_PERM)</span>;</span><br><span class="line">    mkdir<span class="params">(<span class="string">"/ram/tmp"</span>, DEFAULT_DIR_PERM)</span>;</span><br><span class="line"></span><br><span class="line">    symlink<span class="params">(<span class="string">"/ram/boot"</span>, <span class="string">"/boot"</span>)</span>;</span><br><span class="line">    symlink<span class="params">(<span class="string">"/ram/etc"</span>,  <span class="string">"/etc"</span>)</span>;</span><br><span class="line">    symlink<span class="params">(<span class="string">"/ram/ftk"</span>,  <span class="string">"/ftk"</span>)</span>;</span><br><span class="line">    symlink<span class="params">(<span class="string">"/ram/qt"</span>,   <span class="string">"/qt"</span>)</span>;</span><br><span class="line">    symlink<span class="params">(<span class="string">"/ram/lib"</span>,  <span class="string">"/lib"</span>)</span>;</span><br><span class="line">    symlink<span class="params">(<span class="string">"/ram/usr"</span>,  <span class="string">"/usr"</span>)</span>;</span><br><span class="line">    symlink<span class="params">(<span class="string">"/ram/bin"</span>,  <span class="string">"/bin"</span>)</span>;</span><br><span class="line">    symlink<span class="params">(<span class="string">"/ram/sbin"</span>, <span class="string">"/sbin"</span>)</span>;</span><br><span class="line">    symlink<span class="params">(<span class="string">"/ram/apps"</span>, <span class="string">"/apps"</span>)</span>;</span><br><span class="line">    symlink<span class="params">(<span class="string">"/ram/home"</span>, <span class="string">"/home"</span>)</span>;</span><br><span class="line">    symlink<span class="params">(<span class="string">"/ram/root"</span>, <span class="string">"/root"</span>)</span>;</span><br><span class="line">    symlink<span class="params">(<span class="string">"/ram/var"</span>,  <span class="string">"/var"</span>)</span>;</span><br><span class="line">    symlink<span class="params">(<span class="string">"/ram/tmp"</span>,  <span class="string">"/var/tmp"</span>)</span>;</span><br><span class="line">    symlink<span class="params">(<span class="string">"/ram/tmp"</span>,  <span class="string">"/tmp"</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>调试通道使用 SCI3，故 bspInit 函数加入：</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">sciInit()<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>同时 hz 修改为 1000：</p>
<figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line">API_KernelStartParam<span class="list">(<span class="string">"kdlog=no kderror=yes kfpu=no heapchk=yes hz=1000 hhz=1000"</span>)</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<h3 id="bspLib-c_关键内容">bspLib.c 关键内容</h3><p>中断初始化：</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">VOID</span>  bspIntInit (<span class="keyword">VOID</span>)</span><br><span class="line">&#123;</span><br><span class="line">	vimInit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>中断处理（暂时只支持定时器中断）：<br><figure class="highlight openscad"><table><tr><td class="code"><pre><span class="line">VOID  bspIntHandle <span class="params">(VOID)</span></span><br><span class="line">&#123;</span><br><span class="line">    REGISTER UINT32   uiVector = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    archIntHandle<span class="params">(<span class="params">(ULONG)</span>uiVector, LW_FALSE)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>开关中断：</p>
<figure class="highlight openscad"><table><tr><td class="code"><pre><span class="line">VOID  bspIntVectorEnable <span class="params">(ULONG  ulVector)</span></span><br><span class="line">&#123;</span><br><span class="line">	vimChannelMap<span class="params">(ulVector, ulVector, archIntEntry)</span>;</span><br><span class="line">	vimEnableInterrupt<span class="params">(ulVector, SYS_IRQ)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">VOID  bspIntVectorDisable <span class="params">(ULONG  ulVector)</span></span><br><span class="line">&#123;</span><br><span class="line">	vimDisableInterrupt<span class="params">(ulVector)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>处理器特性：<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">ULONG  bspInfoHwcap (VOID)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span>  (HW<span class="built_in">CAP_VFP</span> | HW<span class="built_in">CAP_VFPv3</span> | HW<span class="built_in">CAP_VFPv3D16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>调试信息输出：<br><figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="function">VOID  <span class="title">bspDebugMsg</span> <span class="params">(CPCHAR  pcMsg)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!pcMsg) &#123;                                                       <span class="comment">/*  指针为空                    */</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (*pcMsg != <span class="string">'\0'</span>) &#123;                                            <span class="comment">/*  发送字符串                  */</span></span><br><span class="line">    	sciSendByte(sciREG3, *pcMsg);</span><br><span class="line">        pcMsg++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>定时器相关函数：<br><figure class="highlight openscad"><table><tr><td class="code"><pre><span class="line">static irqreturn_t  __tickTimerIsr <span class="params">(VOID)</span></span><br><span class="line">&#123;</span><br><span class="line">    portRTI_INTFLAG_REG = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    API_KernelTicksContext<span class="params">()</span>;                                           <span class="comment">/*  保存被时钟中断的线程控制块  */</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">#</span><span class="keyword">if</span> TICK_IN_THREAD &gt; <span class="number">0</span></span><br><span class="line">    API_ThreadResume<span class="params">(htKernelTicks)</span>;</span><br><span class="line"><span class="built_in">#</span><span class="keyword">else</span></span><br><span class="line">    API_KernelTicks<span class="params">()</span>;                                                  <span class="comment">/*  内核 TICKS 通知             */</span></span><br><span class="line">    API_TimerHTicks<span class="params">()</span>;                                                  <span class="comment">/*  高速 TIMER TICKS 通知       */</span></span><br><span class="line"><span class="built_in">#</span>endif                                                                  <span class="comment">/*  TICK_IN_THREAD &gt; 0          */</span></span><br><span class="line">    </span><br><span class="line">    return  <span class="params">(LW_IRQ_HANDLED)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static void prvSetupTimerInterrupt<span class="params">(void)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* Disable timer 0. */</span></span><br><span class="line">	portRTI_GCTRL_REG &amp;= <span class="number">0</span>xFFFFFFFEUL;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Use the internal counter. */</span></span><br><span class="line">	portRTI_TBCTRL_REG = <span class="number">0</span>x00000000U;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* COMPSEL0 will use the RTIFRC0 counter. */</span></span><br><span class="line">	portRTI_COMPCTRL_REG = <span class="number">0</span>x00000000U;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Initialise the counter and the prescale counter registers. */</span></span><br><span class="line">	portRTI_CNT0_UC0_REG  =  <span class="number">0</span>x00000000U;</span><br><span class="line">	portRTI_CNT0_FRC0_REG =  <span class="number">0</span>x00000000U;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Set Prescalar for RTI clock. */</span></span><br><span class="line">	portRTI_CNT0_CPUC0_REG = <span class="number">0</span>x00000001U;</span><br><span class="line">	portRTI_CNT0_COMP0_REG = <span class="params">( configCPU_CLOCK_HZ / <span class="number">2</span> )</span> / LW_TICK_HZ;</span><br><span class="line">	portRTI_CNT0_UDCP0_REG = <span class="params">( configCPU_CLOCK_HZ / <span class="number">2</span> )</span> / LW_TICK_HZ;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Clear interrupts. */</span></span><br><span class="line">	portRTI_INTFLAG_REG     =  <span class="number">0</span>x0007000FU;</span><br><span class="line">	portRTI_CLEARINTENA_REG	= <span class="number">0</span>x00070F0FU;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Enable the compare 0 interrupt. */</span></span><br><span class="line">	portRTI_SETINTENA_REG = <span class="number">0</span>x00000001U;</span><br><span class="line">	portRTI_GCTRL_REG    |= <span class="number">0</span>x00000001U;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">VOID  bspTickInit <span class="params">(VOID)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">#</span><span class="keyword">if</span> TICK_IN_THREAD &gt; <span class="number">0</span></span><br><span class="line">    LW_CLASS_THREADATTR  threadattr;</span><br><span class="line"><span class="built_in">#</span>endif                                                                  <span class="comment">/*  TICK_IN_THREAD &gt; 0          */</span></span><br><span class="line">    ULONG                ulVector = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">#</span><span class="keyword">if</span> TICK_IN_THREAD &gt; <span class="number">0</span></span><br><span class="line">    API_ThreadAttrBuild<span class="params">(&amp;threadattr, <span class="params">(<span class="number">8</span> * LW_CFG_KB_SIZE)</span>,</span><br><span class="line">                        LW_PRIO_T_TICK,</span><br><span class="line">                        LW_OPTION_THREAD_STK_CHK |</span><br><span class="line">                        LW_OPTION_THREAD_UNSELECT |</span><br><span class="line">                        LW_OPTION_OBJECT_GLOBAL |</span><br><span class="line">                        LW_OPTION_THREAD_SAFE, LW_NULL)</span>;</span><br><span class="line"></span><br><span class="line">    htKernelTicks = API_ThreadCreate<span class="params">(<span class="string">"t_tick"</span>,</span><br><span class="line">                                     <span class="params">(PTHREAD_START_ROUTINE)</span>__tickThread,</span><br><span class="line">                                     &amp;threadattr,</span><br><span class="line">                                     NULL)</span>;</span><br><span class="line"><span class="built_in">#</span>endif                                                                  <span class="comment">/*  TICK_IN_THREAD &gt; 0          */</span></span><br><span class="line"></span><br><span class="line">    prvSetupTimerInterrupt<span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    API_InterVectorConnect<span class="params">(ulVector,</span><br><span class="line">                           <span class="params">(<span class="literal">PI</span>NT_SVR_ROUTINE)</span>__tickTimerIsr,</span><br><span class="line">                           LW_NULL,</span><br><span class="line">                           <span class="string">"tick_timer"</span>)</span>;</span><br><span class="line"></span><br><span class="line">    API_InterVectorEnable<span class="params">(ulVector)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="CCS调试">CCS调试</h2><p>新建一CCS工程：<br><img src="/img/Hercules-TMS570LC43x-LaunchPad/Image 11.png" alt="Image 11.png"></p>
<p>新建它的调试配置：</p>
<p>配置程序：<br><img src="/img/Hercules-TMS570LC43x-LaunchPad/Image 12.png" alt="Image 12.png"></p>
<p>配置调试开始函数：<br><img src="/img/Hercules-TMS570LC43x-LaunchPad/Image 13.png" alt="Image 13.png"></p>
<p>配置文件查找路径：<br><img src="/img/Hercules-TMS570LC43x-LaunchPad/Image 14.png" alt="Image 14.png"></p>
<p>最后可以把这个调试配置复制一份，调试时只需要加载符号，但不下载，用于快速重启调试：<br><img src="/img/Hercules-TMS570LC43x-LaunchPad/Image 16.png" alt="Image 16.png"></p>
<p>但需要多选择连接时复位：<br><img src="/img/Hercules-TMS570LC43x-LaunchPad/Image 17.png" alt="Image 17.png"></p>
<h2 id="晒图">晒图</h2><p><img src="/img/Hercules-TMS570LC43x-LaunchPad/Image 19.png" alt="Image 19.png"><br><img src="/img/Hercules-TMS570LC43x-LaunchPad/Image 20.png" alt="Image 20.png"></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/SylixOS/">SylixOS</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/ARMv7-R/">ARMv7-R</a><a href="/tags/SylixOS/">SylixOS</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="jiaojinxing.github.io/2017/01/12/Hercules-TMS570LC43x-LaunchPad-SylixOS移植记录/" data-title="Hercules TMS570LC43x LaunchPad SylixOS移植记录 | JinXing’s blog" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2015/11/04/RealEvo-QtSylixOS-功能介绍/"  title="RealEvo-QtSylixOS 功能介绍">
 <strong>下一篇：</strong><br/> 
 <span>RealEvo-QtSylixOS 功能介绍
</span>
</a>
</div>

</nav>

	

<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#硬件连接"><span class="toc-number">1.</span> <span class="toc-text">硬件连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sylixos-base裁减"><span class="toc-number">2.</span> <span class="toc-text">sylixos-base裁减</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#libsylixos裁减"><span class="toc-number">3.</span> <span class="toc-text">libsylixos裁减</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#libsylixos配置"><span class="toc-number">4.</span> <span class="toc-text">libsylixos配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HALCoGen使用"><span class="toc-number">5.</span> <span class="toc-text">HALCoGen使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BSP编写"><span class="toc-number">6.</span> <span class="toc-text">BSP编写</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#链接脚本_SylixOSBSP-ld"><span class="toc-number">6.1.</span> <span class="toc-text">链接脚本 SylixOSBSP.ld</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#config-h"><span class="toc-number">6.2.</span> <span class="toc-text">config.h</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bsparmr5-mk"><span class="toc-number">6.3.</span> <span class="toc-text">bsparmr5.mk</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bspInit-c关键内容"><span class="toc-number">6.4.</span> <span class="toc-text">bspInit.c关键内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bspLib-c_关键内容"><span class="toc-number">6.5.</span> <span class="toc-text">bspLib.c 关键内容</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CCS调试"><span class="toc-number">7.</span> <span class="toc-text">CCS调试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#晒图"><span class="toc-number">8.</span> <span class="toc-text">晒图</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/SylixOS/" title="SylixOS">SylixOS<sup>14</sup></a></li>
		  
		
		  
			<li><a href="/categories/全栈/" title="全栈">全栈<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/SylixOS/" title="SylixOS">SylixOS<sup>14</sup></a></li>
			
		
			
				<li><a href="/tags/测试/" title="测试">测试<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/ARMv7-M/" title="ARMv7-M">ARMv7-M<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/全栈/" title="全栈">全栈<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/硬件/" title="硬件">硬件<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/U-Boot/" title="U-Boot">U-Boot<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/ARMv7-R/" title="ARMv7-R">ARMv7-R<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://www.sylixos.com" target="_blank" title=" SylixOS社区">SylixOS</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> SylixOS操作系统开发者 <br/>
			北京翼辉信息技术有限公司</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/jiaojinxing" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
		<a href="mailto:jiaojinxing1987@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2017 
		
		<a href="/about" target="_blank" title="jiaojinxing">jiaojinxing</a>
		
		
		</p>
		
		<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
		<span id="busuanzi_container_page_pv">本文总阅读量 <span id="busuanzi_value_page_pv"></span> 次</span>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>




<script type="text/javascript">

var disqus_shortname = 'jinxingblog';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<script>
var option = {
  engineKey: 'fdc3f1775f4719dd9d41'
};
(function(w,d,t,u,n,s,e){
  s = d.createElement(t);
  s.src = u;
  s.async = 1;
  w[n] = function(r){
    w[n].opts = r;
  };
  e = d.getElementsByTagName(t)[0];
  e.parentNode.insertBefore(s, e);
})(window,document,'script','//tinysou-cdn.b0.upaiyun.com/ts.js','_ts');
_ts(option);
</script>

<!-- Tiny_search End -->

  </body>
</html>
